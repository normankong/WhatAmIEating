<!DOCTYPE html>
<html>

<head>

    <meta name="viewport" content="user-scalable=1.0,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0">
    <title>Calories Detector</title>

    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700" rel="stylesheet">

    <script src="https://unpkg.com/file-upload-with-preview"></script>


    <link rel="stylesheet" type="text/css" href="https://unpkg.com/file-upload-with-preview/dist/file-upload-with-preview.min.css">
    <style>
        html {
                position: relative;
                min-height: 100%;
            }

            body {
                width: 100%;
                height: 100%;
                color: #333;
                font-family: 'Montserrat', sans-serif;
                font-size: 1rem;
                line-height: 1.5;
                margin: 0;
            }

            a {
                color: #4ea2f5;
                text-decoration: none;
            }

            a:hover {
                color: #3f7ebd;
            }

            /*Pre, Code*/

            pre {
                font-family: SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace
            }

            pre {
                padding: .2rem .4rem;
                font-size: 90%;
                color: #333;
                background-color:#EDEDE8;
                border-radius: .25rem
            }

            /*Header*/

            .header-container {
                margin-top: 30px;
                padding-left: 10px;
                padding-right: 10px;
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            .header-container__header-image {
                max-width: 100%;
                max-height: 60px;
                margin-bottom: 20px;
            }

            .header-container__header-content {
                font-size: 2.5rem;
                margin-bottom: 20px;
                margin-top: 0;
                text-align: center;
            }

            .header-container__code {
                margin-bottom: 10px;
            }

            /*Upload Container*/

            .demo-upload-container {
                padding: 10px 10px;
                margin-left: auto;
                margin-right: auto;
                max-width: 1000px;
                position: relative;
                display: flex;
                flex-direction: row;
                justify-content: space-around;
                flex-wrap: wrap;
            }

            /*Info Container*/

            .demo-info-container {
                margin-left: auto;
                margin-right: auto;
                margin-bottom: 40px;
                max-width: 300px;
                position: relative;
                display: flex;
                flex-direction: row;
                justify-content: space-around;
                flex-wrap: wrap;

                background: #4ea2f5;
                padding: 15px 15px;
                border-radius: 6px;
                text-align: center;
                color: white;
            }

            .demo-info-container a {
                color: white;
                text-decoration: underline;
            }

            .demo-info-container a:hover {
                color: #eee;
            }

            .upload-info-button {
                display: block;
                margin-bottom: 10px;
            }


            /* Loader */
            .loader {
                border: 16px solid #f3f3f3;
                border-radius: 50%;
                border-top: 16px solid #3498db;
                width: 60px;
                height: 60px;
                -webkit-animation: spin 2s linear infinite; /* Safari */
                animation: spin 2s linear infinite;
                margin: auto;
                margin-bottom: 15px;
            }

            /* Safari */
            @-webkit-keyframes spin {
                0% { -webkit-transform: rotate(0deg); }
                100% { -webkit-transform: rotate(360deg); }
            }

            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }

            .hideClass {display:none;}
        </style>

</head>

<body>

    <h1 class="header-container__header-content">
        Calories Detector
    </h1>


    <div class="demo-upload-container">
        <form id="uploadFrm" action="/upload" enctype="multipart/form-data" method="POST">
            <div class="custom-file-container" data-upload-id="myFirstImage">
                <label>Upload (Single File Max 5M) <a href="javascript:void(0)" class="custom-file-container__image-clear"
                        title="Clear Image">&times;</a></label>
                <label class="custom-file-container__custom-file">
                    <input type="file" name="photo" class="custom-file-container__custom-file__custom-file-input"
                        accept="image/*">
                    <input type="hidden" name="MAX_FILE_SIZE" value="5242880" />
                    <span class="custom-file-container__custom-file__custom-file-control"></span>
                </label>
                <div class="custom-file-container__image-preview"></div>
            </div>
        </form>

    </div>

    <div class="loader hideClass" id="loader"></div>

    <div class="demo-info-container">
        <div>
            <a href="javascript:void(0)" class="upload-info-button upload-info-button--first">Check</a>
            <div id="result"></div>
        </div>
    </div>


    <script>
        // First upload
        /*eslint-disable no-undef */
        var firstUpload = new FileUploadWithPreview('myFirstImage');
        var firstUploadInfoButton = document.querySelector('.upload-info-button--first');
        firstUploadInfoButton.addEventListener('click', function () {

            console.log('First upload:', firstUpload, firstUpload.cachedFileArray);
            if (firstUpload.cachedFileArray.length === 0)
            {
            	 $("#result").html("Please select a file");
            	 return;cl
            }
            
            $(".loader").removeClass("hideClass");
            $(".demo-info-container").addClass("hideClass");
            $("#result").html("");

            setTimeout(upload, 1000);

        });

        function upload() {
            // Prepare AJAX Upload
            var formData = new FormData($('#uploadFrm')[0]);
            $.ajax({
                url: '/upload',
                type: 'POST',
                data: formData,
                async: false,
                cache: false,
                contentType: false,
                processData: false,
                success: function (returndata) {
                    $(".loader").addClass("hideClass");
                    $(".demo-info-container").removeClass("hideClass");
                    $("#result").html(returndata);
                },
                error: function (err) {
                    $(".loader").addClass("hideClass");
                    $(".demo-info-container").removeClass("hideClass");
                    //alert("error in ajax form submission");
                    $("#result").html(err.responseText);
                }
            });
        }
    </script>

</body>
</html>